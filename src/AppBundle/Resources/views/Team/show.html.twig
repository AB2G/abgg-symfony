{% extends '::base.html.twig' %}

{% block body -%}
    <h1>Team</h1>
	<br>
	
	{%if validation == true and app.user.capitain!=null%}
		<div class="alert alert-info">
		    <strong> 
	    		<span class="glyphicon glyphicon-warning-sign" aria-hidden="true"></span>
	    		Info!
	    	</strong> 
	    	Vous avez désormais suffisement de joueurs afin de valider votre équipe. <br>
	    	SEUL UNE EQUIPE VALIDEE POURRA ETRE INSCRITE
	    	<br>
	    	<br>
    		<a class="btn btn-default" href="{{ path('validate_team', {'team':team.id} ) }}">
	    		Valider l'équipe
	    	</a>
		</div>
	{%endif%}
	
	{%if team.validation != null%}
		<div class="alert alert-info">
		    <strong> 
	    		<span class="glyphicon glyphicon-warning-sign" aria-hidden="true"></span>
	    		Info
	    	</strong> 
	    	Votre équipe est validée. Si vous désirez procéder à des modifications d'équipe, contactez les admins<br>
	    </div>
	{%endif%}

	<br>

    <table class="table table-hover">
        <tbody>
            <tr>
                <th>Nom de l'équipe</th>
                <td>{{ team.name }}</td>
                <td></td>
                {%if team.captain.tournament.systName == 'lol'%}
                	<td></td>
                {%endif%}
                {%if players%}
                	<td></td>
                {%endif%}
				<td></td>
            </tr>
            <tr>
                <th>Capitaine d'équipe</th>
                <td>{{ team.captain.username }}</td>
                <td>
	                <img width="15%" src="{{ asset('bundles/app/images/'~team.captain.tournament.systName~'/'~team.captain.experience.ranking.name~'.png') }}" />
	                {{ team.captain.experience.ranking.name }}
                </td>
                {%if team.captain.tournament.systName == 'lol' and  team.captain.experience.ranking.name!='Pas classé'%}
                	<td>{{ team.captain.experience.underRanking.name }}</td>
                {%elseif team.captain.experience.underRanking == null %}
                	<td></td>
                {%endif%}
                {%if team.captain.role%}
                	<td>
	                	{{ team.captain.role.name }}
	                	{%if team.tournament.systName=='lol' and team.validation == null%}
		                	<a class="btn btn-default"  href="{{ path('edit_capitain_role_team', {'id':app.user.id} ) }}">
		                		<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
		                	</a>  
	                	{%endif%}
	                </td>
                {%endif%}
	            {%if app.user == team.captain  and team.validation == null%}
	            	<td>
	                	<a class="btn btn-default"  href="{{ path('team_delete', {'id':team.id} ) }}">
	                		<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
	                	</a>  
	            	</td>
	            {%else%}
	            	<td></td>
	            {%endif%}
            </tr>
            {%for player in players%}
				<tr>
					{%if player.user.manager%}
						<th>Manager</th>
					{%else%}
						<th>Joueur</th>
					{%endif%}
					<td>{{player.user.username}}</td>
					{%if player.user.manager%}
						<td>MANAGER</td>
						{%if team.captain.tournament.systName == 'lol'%}
							<td></td>
						{%elseif team.captain.tournament.systName == 'csgo'%}
							<td></td>
						{%endif%}
					{%else%}
                		<td>
	                		<img width="15%" src="{{ asset('bundles/app/images/'~player.user.tournament.systName~'/'~player.user.experience.ranking.name~'.png') }}" />
	                		{{player.user.experience.ranking.name }}
                		</td>
		                {%if team.captain.tournament.systName == 'lol' 
		                and  player.user.experience.ranking.name!='Pas classé'%}
		                	<td>{{ player.user.experience.underRanking.name }}</td>
		                {%elseif player.user.experience.underRanking == null %}
		                	<td></td>
		                {%endif%}
                	{%endif%}
                	{%if player.role%}
						<td>{{player.role.name}}</td>
					{%endif%}
		            {%if ((app.user == player.user)  and (team.validation == null))%}
		            	<td>
		                	<a class="btn btn-default"  href="{{ path('quit_team', {'playerId':player.id} ) }}">
		                		<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
		                	</a>
		            	</td>
		            {%elseif ((app.user.capitain == true)  and (team.validation == null))%}
		            	<td>
		                	<a class="btn btn-default"  href="{{ path('quit_team', {'playerId':player.id} ) }}">
		                		<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
		                	</a>
		            	</td>
		            {%else%}
		            	<td></td>
		            {%endif%}
				</tr>
			{%endfor%}
        </tbody>
    </table>
    <br>
    {%if team.validation == null%}
	    <a class="btn btn-default" href="{{ path('team_edit', {'id':app.user.team.id} ) }}">
	        <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
	        Modifier
	    </a>
	{%endif%}
	<br><br><br>
	
	{%if team.validation == null %}
		{%if  (countCandidatsService.getAllSearchingCandidats(app.user.team.id))!= null %}
		    <h2>Candidatures déposées par les joueurs
		    	<span class="badge">{{ countCandidatsService.getSearchingCandidats(app.user.team.id) }}</span>
		    </h2>
		    
	    	<table class="table table-hover">
		        <tbody>
		            <tr>
		                <th>Pseudo joueur</th>
		                <th>Classement</th>
		                {%if app.user.tournament.systName == 'lol'%}
		                	<th>Sous-classement</th>
		                {%endif%}
		                <th>Poste désiré</th>
		                <th>Réponse</th>
		            </tr>
				    {%for candidats in (countCandidatsService.getAllSearchingCandidats(app.user.team.id)) %}
				    <tr>
				    	<td>{{candidats.user.username}}</td>
				    	{%if candidats.user.manager %}
					    	{%if app.user.tournament.systName == 'lol'%}
					    		<td></td>
					    		<td></td>
					    	{%elseif app.user.tournament.systName == 'csgo'%}
				    			<td></td>
					    		<td>Manager</td>
					    	{%endif%}
				    	{%else%}
					    	<td>{{candidats.user.experience.ranking.name}}</td>
			                {%if app.user.tournament.systName == 'lol' 
			                and candidats.user.manager == null 
			                and candidats.user.experience.ranking.name != 'Pas classé'%}
					    		<td>{{candidats.user.experience.underRanking.name}}</td>
			                {%else%}
			                	<td></td>
		                	{%endif%}
		                {%endif%}
				    	{%if app.user.tournament.systName == 'lol' %}
				    		<td>{{candidats.role}}</td>
		                {%endif%}
		                {%if app.user.capitain%}
			                <td>
			                	<a class="btn btn-default"  href="{{ path('validate_application_team', {'candidats':candidats.id} ) }}">
			                		<span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
			                	</a>
			                	<a class="btn btn-default"  href="{{ path('delete_application', {'candidats':candidats.id} ) }}">
			                		<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
			                	</a>
			                </td>
			            {%else%}
			            	<td>
			            		Seul le capitain d'équipe peut accepter ou rejetter une cadidature
			            	</td>
			            {%endif%}
				    </tr>
				    {%endfor%}
				</tbody>
			</table>
		{%endif%}
	
		<br><br><br>
	    
	    {%if (countCandidatsService.getAllApplicationFromTeam(app.user.team.id)) != null%}
		    <h2>Recrutement par le chef d'équipe en attente de réponse
		    	<span class="badge">{{ countCandidatsService.getApplicationFromTeam(app.user.team.id) }}</span>
		    </h2>
		    
		    <table class="table table-hover">
		        <tbody>
		            <tr>
		                <th>Pseudo joueur</th>
		                <th>Classement</th>
		                {%if app.user.tournament.systName == 'lol'%}
		                	<th>Sous-classement</th>
		                {%endif%}
		                <th>Poste désiré</th>
		                <th>Réponse</th>
		            </tr>
				    {%for candidats in (countCandidatsService.getAllApplicationFromTeam(app.user.team.id)) %}
				    <tr>
				    	{%if candidats.user == null%}
				    		<td>{{candidats.email}}</td>
				    		<td> </td>
				    		<td> </td>
				    		<td> </td>
				    	{%else%}
				    		<td>{{candidats.user.username}}</td>
					    	{%if candidats.user.manager %}
					    		<td></td>
					    		<td></td>
					    	{%elseif candidats.user%}
						    	<td>{{candidats.user.experience.ranking.name}}</td>
				                {%if app.user.tournament.systName == 'lol' 
				                and candidats.user.manager == null 
				                and candidats.user.experience.ranking.name != 'Pas classé'%}
						    		<td>{{candidats.user.experience.underRanking.name}}</td>
				                {%else%}
				                	<td></td>
			                	{%endif%}
					    	{%else%}
				                <td></td>
			                {%endif%}
					    	{%if app.user.tournament.systName == 'lol' %}
					    		<td>{{candidats.role}}</td>
			                {%endif%}
				    	{%endif%}
		                {%if app.user.capitain%}
			                <td>
			                	<a class="btn btn-default"  href="{{ path('delete_application_recrutement', {'id':candidats.id} ) }}">
			                		<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
			                	</a>
			                </td>
			            {%else%}
			            	<td>
			            		Seul le capitain d'équipe peut accepter ou rejetter une cadidature
			            	</td>
			            {%endif%}
				    </tr>
				    {%endfor%}
				</tbody>
			</table>
	    {%endif%}
	    
	{%else%}
		
	{%endif%}
{% endblock %}
